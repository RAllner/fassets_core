=javascript_include_tag "fassets_core/facets.js"
=javascript_include_tag "fassets_core/classification.js"
.collapsible
  %h2.title New Classification
  =form_for Classification.new(:asset_id => @content.asset.id), :url => main_app.classifications_path do |f|
    %p
      %label{:for => 'catalog_id'} Catalog:
      =select("classification", "catalog_id", Catalog.all.inject([]){|m,c| m << [c.title, c.id]})
    =hidden_field_tag "classification[asset_id]", @content.asset.id.to_s
    =submit_tag "Create", :class => "classification_create"


.collapsible
  %h2.title Classifications
  %ul.collection
    -catalogs = []
    -@content.asset.classifications.each do |classification|
      -catalogs << classification.catalog_id
      %li
        =link_to classification.catalog.title, main_app.catalog_path(classification.catalog), :class => "classification_title"
        .content
          =form_for classification, :remote => true do |f|
            -classification.catalog.facets.each do |facet|
              .facet{:class => "#{facet.color}_lite"}
                .caption{:class => facet.color}
                  =facet.caption
                %ul
                  -facet.labels.each do |label|
                    %li.label
                      =check_box_tag "labels[]", label.id, classification.label_ids.include?(label.id)
                      =link_to label.caption
            =submit_tag "Save"
            =submit_tag "Drop", :class => "classification_drop", :classification_id => classification.id, :style => "float: left", :onclick => "return confirm('Are you sure?')"

