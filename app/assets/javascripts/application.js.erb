// Place your application-specific JavaScript functions and classes here
//
//= require jquery
//= require jquery_ujs
//= require dombuilder
//= require jquery-ui
//= require jquery.ui.nestedSortable
//= require jquery.collapsiblePanel-0.2.0
//= require jquery.myimgscale-0.2
//= require jquery.fancyzoom
//= require_self
//= require_tree .
//
$(document).ready(function(){
  $('#tray ol').sortable({
    items: 'li',
    connectWith: "ul",
    update: function(ev, ui){
      $.ajax({
        type: 'put',
        data: $('.sortable_tray').sortable('serialize')+"&asset_id="+$(ui.item).attr("asset_id"),
        dataType: 'script',
        complete: function(request){
          window.location.reload();
          $('#tray').effect('highlight',{},2000);
        },
        url: "/" + $('.sortable_tray').attr('id').replace(/\./g,"/")})
    },
  });
  $('ul #assets').draggable({
    items: 'li',
    connectToSortable: "#tray ol",
    helper: "clone",
  });

  $(".collapsable_label").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".labeltitle",
    startCollapsed: true
  });
  $(".collapsable_facetlabels").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".facetlabelstitle",
    startCollapsed: true
  });
  $(".collapsable_facet").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".facettitle",
    startCollapsed: true
  });
  $(".collapsable_frame").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".frametitle",
    startCollapsed: true
  })
  $(".collapsable_topic").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".topictitle",
    startCollapsed: true
  })
  $(".collapsable_catalog").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".catalogtitle",
    startCollapsed: true
  })
  $(".collapsable_classification").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".classificationtitle",
    startCollapsed: true
  })
  $(".collapsable_classificationfacet").collapsiblePanel({
    collapsedImage: "<%= image_path 'collapsed.png' %>",
    expandedImage: "<%= image_path 'collapse.png' %>",
    titleQuery: ".classificationfacettitle",
    startCollapsed: true
  })
//    $(".content .preview").css("font-size", $(window).height()/32 + 'px');
//  });
  $('form[class$="_asset"] input[name="commit"], form[class$="_presentation"] input[name="commit"], form[class$="_url"] input[name="commit"]').click(function (event){
    if ($("#asset_name").val() == "") {
      $("#name_warning").text("Name cannot be empty!");
      event.preventDefault();
    }
    if ($("#file_asset_file").val() == ""){
      $("#file_warning").text("File cannot be empty!");
      event.preventDefault();
    }
    if ($("#presentation_title").val() == ""){
      $("#title_warning").text("Title cannot be empty!");
      event.preventDefault();
    }
    if ($("#url_url").val() == ""){
      $("#url_warning").text("Url cannot be empty!");
      event.preventDefault();
    }
  })
});
